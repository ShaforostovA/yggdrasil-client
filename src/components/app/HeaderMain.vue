<template>
  <header class="pt-5 mb-5 flex">
  <div class="flex-grow">
    <router-link to="/" class="main-logo inline-flex items-center shrink-0">
      <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="60pt" viewBox="0 0 1280.000000 1280.000000"
        preserveAspectRatio="xMidYMid meet">
        <g class="fill-[var(--color-main)]" transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)"
          fill="#000000" stroke="none">
          <path
            d="M6095 12794 c-27 -2 -115 -8 -195 -14 -1141 -84 -2267 -492 -3209 -1165 -1692 -1208 -2691 -3144 -2691 -5215 0 -1331 414 -2627 1186 -3710 821 -1152 2011 -2008 3354 -2414 840 -253 1704 -332 2570 -236 1302 146 2508 677 3505 1544 148 129 461 442 592 592 796 914 1305 1982 1503 3157 283 1679 -111 3395 -1096 4777 -882 1238 -2182 2128 -3644 2495 -340 86 -633 135 -1005 171 -150 14 -756 27 -870 18z m148 -477 c8 -12 38 -64 66 -115 l51 -91 -60 -108 c-33 -59 -87 -161 -120 -228 -34 -66 -69 -131 -79 -144 l-18 -23 -28 48 c-136 237 -352 457 -559 570 -38 21 -65 39 -60 41 66 19 549 67 720 71 65 2 73 0 87 -21z m221 -54 c-31 -43 -59 -79 -62 -80 -4 -1 -25 25 -47 58 -22 33 -46 69 -54 80 -13 18 -10 19 102 19 l116 0 -55 -77z m521 51 c213 -21 385 -46 385 -54 0 -4 -11 -11 -24 -14 -37 -9 -191 -115 -283 -195 -94 -82 -187 -194 -280 -339 l-66 -102 -19 27 c-11 16 -44 78 -75 138 -30 61 -82 158 -114 217 -33 59 -59 113 -59 120 0 7 28 62 61 122 l61 109 137 -7 c75 -4 199 -14 276 -22z m-1500 -155 c196 -216 273 -337 339 -528 59 -169 69 -230 63 -361 -7 -147 -8 -149 -60 -143 -341 39 -618 270 -816 683 -55 114 -136 328 -128 336 10 10 471 113 502 112 6 0 51 -45 100 -99z m2135 59 c134 -27 291 -65 298 -72 6 -6 -50 -162 -95 -266 -143 -329 -335 -556 -568 -671 -88 -43 -215 -79 -280 -79 -51 0 -53 4 -62 136 -7 108 6 186 53 333 67 204 155 347 327 528 59 62 107 118 107 124 0 11 13 9 220 -33z m-2742 -180 c71 -587 361 -1090 772 -1339 l60 -36 -28 -26 c-32 -30 -113 -72 -161 -82 -56 -12 -261 4 -261 21 0 23 -84 178 -136 250 -131 185 -366 443 -529 584 -188 162 -311 237 -531 326 -76 30 -140 57 -142 59 -12 12 366 166 584 239 144 48 331 104 349 105 6 1 16 -44 23 -101z m3285 40 c242 -74 717 -259 717 -278 0 -3 -44 -24 -97 -45 -370 -145 -623 -341 -959 -743 -156 -187 -242 -321 -277 -433 -9 -26 -215 -37 -289 -15 -58 17 -153 75 -153 94 0 6 41 38 90 70 324 215 572 593 684 1047 17 69 27 130 57 333 6 40 -2 41 227 -30z m-1711 -182 c108 -294 156 -540 186 -951 28 -387 34 -345 -100 -740 -64 -187 -120 -351 -126 -365 l-9 -25 -15 35 c-8 19 -65 188 -128 375 -104 315 -112 345 -112 415 0 41 5 104 11 140 6 36 11 106 11 155 1 307 92 755 210 1030 25 59 26 58 72 -69z m-2493 -223 c144 -110 297 -241 377 -324 77 -81 195 -240 258 -348 56 -94 150 -300 142 -308 -14 -14 -406 141 -576 228 -220 111 -870 518 -870 544 0 13 521 294 544 295 6 0 62 -39 125 -87z m5134 26 c118 -59 393 -213 410 -229 16 -15 -139 -122 -449 -312 -309 -189 -505 -293 -684 -362 -159 -61 -305 -114 -308 -111 -6 6 93 219 141 304 127 222 283 397 530 594 211 168 221 176 230 177 4 0 62 -28 130 -61z m-5606 -498 c264 -264 336 -325 563 -476 241 -160 708 -421 903 -505 221 -95 573 -188 728 -193 45 -2 59 -6 59 -17 0 -8 7 -87 15 -175 20 -212 30 -660 20 -917 l-7 -207 -85 117 c-214 293 -386 474 -678 714 -66 54 -156 130 -200 169 -179 158 -482 333 -714 414 -186 64 -412 112 -619 131 l-72 7 -68 72 c-133 143 -200 297 -222 513 -11 102 -1 237 25 337 35 133 88 255 112 255 1 0 110 -107 240 -239z m6085 227 c18 -14 69 -142 92 -232 78 -301 13 -623 -168 -834 -81 -94 -88 -98 -216 -111 -281 -30 -572 -111 -804 -225 -158 -77 -370 -217 -486 -320 -47 -41 -139 -119 -205 -173 -239 -193 -522 -496 -689 -736 l-61 -89 -8 174 c-11 230 -2 697 18 933 9 105 17 194 18 198 2 5 27 11 57 13 124 9 394 72 560 130 163 56 299 121 556 264 610 339 793 476 1178 882 72 76 134 138 137 138 3 0 12 -6 21 -12z m-6455 -105 c-103 -135 -191 -319 -221 -465 -21 -100 -20 -152 4 -375 12 -102 19 -188 16 -190 -2 -3 -55 -9 -117 -14 -426 -34 -841 -199 -1209 -479 -42 -32 -82 -65 -89 -74 -8 -10 -23 -22 -34 -27 -35 -19 200 307 358 496 253 303 553 598 855 841 146 117 454 341 473 343 5 1 -12 -25 -36 -56z m6683 -49 c570 -394 1078 -904 1496 -1504 l59 -85 -80 65 c-385 314 -807 489 -1274 530 -63 5 -115 11 -117 13 -2 2 6 84 17 183 28 236 23 345 -20 474 -40 119 -117 266 -187 360 -30 39 -48 68 -41 64 6 -4 73 -49 147 -100z m-6790 -1299 c516 -64 983 -288 1363 -655 89 -86 105 -105 90 -111 -10 -4 -27 -17 -38 -29 -34 -39 -178 -147 -257 -194 -81 -48 -182 -94 -264 -120 l-52 -17 -108 112 c-321 329 -724 562 -1124 648 -387 83 -841 64 -1177 -49 -46 -15 -83 -24 -83 -20 0 8 191 128 290 182 227 124 511 215 785 252 139 19 424 19 575 1z m7452 -14 c244 -44 506 -137 712 -251 129 -72 266 -159 266 -170 0 -4 -37 6 -81 22 -198 70 -461 103 -748 95 -333 -9 -588 -68 -859 -198 -255 -121 -463 -270 -671 -477 l-133 -133 -67 22 c-146 48 -336 161 -478 286 -36 31 -67 52 -74 48 -36 -23 24 46 115 130 393 366 837 575 1371 645 39 5 174 7 300 5 180 -2 255 -7 347 -24z m-8517 -446 c154 -25 251 -59 530 -189 379 -177 548 -274 666 -384 55 -51 129 -141 129 -157 0 -10 -204 3 -345 21 -457 58 -896 226 -1246 475 -103 73 -282 220 -275 226 23 23 413 29 541 8z m9429 -2 l28 -9 -63 -55 c-374 -326 -850 -545 -1363 -629 -130 -21 -433 -47 -442 -37 -9 9 79 119 133 167 115 101 309 212 630 361 341 159 384 174 568 205 88 15 457 12 509 -3z m-9945 -102 c191 -289 554 -594 906 -762 232 -110 537 -191 926 -246 153 -21 609 -24 764 -4 290 37 719 196 782 289 l22 33 25 -43 c33 -57 96 -191 141 -303 25 -63 39 -116 45 -175 12 -119 33 -491 27 -496 -2 -3 -37 14 -78 37 -41 23 -112 60 -159 81 -788 365 -1616 423 -2311 164 -112 -41 -275 -59 -399 -44 -131 16 -319 109 -475 235 -209 169 -346 478 -362 813 -7 157 24 397 64 490 14 32 16 33 26 16 7 -10 32 -48 56 -85z m10056 -36 c49 -213 46 -462 -6 -662 -71 -270 -198 -456 -412 -601 -201 -137 -304 -174 -477 -173 -148 1 -200 10 -340 59 -468 164 -972 192 -1502 83 -310 -64 -596 -166 -886 -316 -69 -36 -126 -64 -127 -62 -4 5 15 352 25 460 10 102 17 132 57 230 24 62 69 160 99 219 l55 107 34 -38 c78 -86 385 -209 648 -260 231 -45 629 -52 902 -16 248 33 569 107 745 172 420 156 845 489 1090 856 29 44 56 75 60 70 5 -4 20 -62 35 -128z m-10205 10 c-29 -84 -68 -268 -79 -377 -28 -256 -4 -451 96 -790 4 -12 -8 -23 -45 -42 -113 -57 -269 -173 -373 -276 -149 -148 -224 -257 -300 -435 -21 -49 -39 -81 -39 -70 0 11 16 96 35 189 107 519 273 1003 501 1459 76 150 212 397 219 397 2 0 -5 -25 -15 -55z m10307 -80 c255 -456 453 -955 582 -1470 32 -127 91 -410 91 -435 0 -8 -17 23 -37 70 -122 283 -325 504 -623 677 -52 31 -96 57 -98 58 -1 1 7 27 18 59 67 195 94 388 87 613 -6 205 -35 372 -93 538 l-6 20 14 -20 c8 -11 37 -61 65 -110z m-10085 -1502 c59 -101 128 -177 196 -216 l55 -30 -64 -55 c-35 -30 -113 -105 -174 -166 -478 -483 -769 -1115 -846 -1836 -14 -131 -14 -485 0 -604 6 -50 9 -91 7 -94 -6 -5 -92 355 -115 483 -28 151 -57 349 -78 540 -15 130 -18 240 -17 590 0 263 5 453 11 490 14 75 87 276 138 375 155 308 404 501 750 584 33 8 67 15 76 15 10 1 33 -28 61 -76z m9988 47 c179 -44 352 -141 486 -274 132 -131 223 -285 303 -514 37 -104 41 -128 52 -280 15 -214 6 -763 -16 -967 -32 -306 -91 -641 -155 -880 l-29 -110 7 95 c12 168 6 516 -12 652 -21 167 -60 354 -102 500 -108 371 -303 749 -541 1047 -78 98 -299 326 -387 398 l-48 40 47 23 c67 32 141 112 200 214 57 98 42 94 195 56z m-8033 -415 c417 -55 819 -231 1168 -512 120 -97 318 -298 437 -443 263 -322 432 -665 518 -1050 69 -311 69 -699 -1 -1110 -122 -724 -538 -1357 -1133 -1729 -150 -94 -390 -201 -566 -253 -89 -26 -266 -63 -375 -79 -116 -17 -454 -17 -570 0 -527 77 -907 265 -1309 652 -99 95 -135 138 -211 254 -267 407 -505 900 -656 1358 -26 81 -29 101 -29 226 0 638 196 1303 518 1760 363 515 963 849 1667 930 123 14 416 12 542 -4z m6543 -10 c265 -41 504 -116 735 -230 255 -125 433 -253 614 -440 447 -464 690 -1121 726 -1965 l6 -145 -60 -176 c-153 -445 -365 -881 -626 -1289 -81 -125 -111 -162 -222 -270 -211 -206 -391 -338 -603 -441 -777 -381 -1728 -274 -2425 271 -120 95 -326 302 -412 415 -249 330 -415 691 -493 1074 -48 236 -65 413 -64 686 0 226 3 277 23 388 72 409 229 770 471 1087 477 624 1042 968 1730 1054 83 10 499 -3 600 -19z" />
        </g>
      </svg>
      <div class="main-logo-name text-[var(--color-main)] text-3xl ml-1">
        Иггдрасиль
      </div>
    </router-link>
  </div>
  <div class="header-profile flex items-center">
    <button v-if="false" class="notification block p-3 transition-all duration-100 rounded-lg hover:bg-gray-200 active:bg-gray-300">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
        class="w-8 h-8 stroke-[var(--color-main)] transition-all duration-100">
        <path class="stoke-teal-400" stroke-linecap="round" stroke-linejoin="round"
          d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
      </svg>
    </button>
    <a href="#" class="dropdown-trigger profile main-btn px-5 py-3 flex min-w-[140px] justify-center" data-target='dropdownProfile' ref="dropdown">
      {{ currentUser !== undefined ? (currentUser.lastname + ' ' + currentUser.name[0] + '. ' + currentUser.patronymic[0] + '.') : 'user' }}
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-6 ml-2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
      </svg>
    </a>
    <ul id="dropdownProfile" class="dropdown-content rounded-lg">
      <li>
        <router-link to="/profile">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-2">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0112 21a8.966 8.966 0 01-5.982-2.275M15 9.75a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          <div>Профиль</div>
        </router-link>
      </li>
      <li class="divider" tabindex="-1"></li>
      <li>
        <a href="#" @click.prevent="logout">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" />
          </svg>
          <div>Выйти</div>
        </a>
      </li>
    </ul>
  </div>
</header>
</template>

<script>
export default {
  data: () => ({
    dropdown: null,
  }),
  methods: {
    logout() {
      this.$store.dispatch('auth/logout');
      this.$router.push('/login?message=logout')
    }
  },
  computed: {
    currentUser() {
      return this.$store.state.auth.user;
    }
  },
  mounted() {
    this.dropdown = M.Dropdown.init(this.$refs.dropdown, {
      constrainWidth: true
    })
    if (!this.currentUser) {
      this.$router.push({name: 'login'});
    }
  },
  beforeDestroy() {
    if(this.dropdown && this.dropdown.destroy) {
      this.dropdown.destroy()
    }
  }
}
</script>